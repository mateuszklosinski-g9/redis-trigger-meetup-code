trigger:
- none

pool:
  vmImage: 'windows-latest'

steps:
- task: UseDotNet@2
  inputs:
    packageType: 'sdk'
    version: '9.x'

- task: NuGetToolInstaller@1  # Ensure NuGet CLI is installed

- task: NuGetCommand@2
  inputs:
    command: 'restore'
    restoreSolution: '**/G9.Redis.Trigger*.csproj'

- task: VSBuild@1
  inputs:
    solution: '**/G9.Redis.Trigger*.csproj'
    msbuildArgs: '/p:Configuration=Release'
    platform: 'Any CPU'
    configuration: 'Release'


- task: NuGetCommand@2
  inputs:
    command: 'pack'
    packagesToPack: '**/G9.Redis.Trigger*.csproj'
    versioningScheme: 'byEnvVar'
    versionEnvVar: 'BUILD_BUILDNUMBER'

- task: NuGetCommand@2
  inputs:
    command: 'push'
    packagesToPush: '**/G9.Redis.Trigger*.nupkg'
    nuGetFeedType: 'internal'
    publishVstsFeed: 'G9.Redis/g9-redis-feed'
    allowPackageConflicts: true

